#!/usr/bin/env node

async function testSimpleAPI() {
  console.log('üß™ TESTANDO API SIMPLES')
  console.log('=' .repeat(60))

  try {
    // 1. Testar API sem par√¢metros
    console.log('\n1Ô∏è‚É£ TESTANDO API SEM PAR√ÇMETROS...')
    
    try {
      const response1 = await fetch('https://www.ithostbr.tech/api/dashboard/multi-client-stats-simple')
      const data1 = await response1.json()
      
      if (response1.ok) {
        console.log('‚úÖ API simples funcionando!')
        console.log(`üìä Total tickets: ${data1.total_tickets}`)
        console.log(`üìä Contextos selecionados: ${data1.selected_contexts?.length || 0}`)
        console.log(`üìä Tickets recentes: ${data1.recent_tickets?.length || 0}`)
      } else {
        console.log('‚ùå API simples com erro:', response1.status, data1)
      }
    } catch (error) {
      console.log('‚ùå Erro ao testar API simples:', error.message)
    }

    // 2. Testar API com contexto espec√≠fico (Luft Agro)
    console.log('\n2Ô∏è‚É£ TESTANDO API COM CONTEXTO LUFT AGRO...')
    
    try {
      const luftAgroId = '6486088e-72ae-461b-8b03-32ca84918882'
      const response2 = await fetch(`https://www.ithostbr.tech/api/dashboard/multi-client-stats-simple?context_ids=${luftAgroId}`)
      const data2 = await response2.json()
      
      if (response2.ok) {
        console.log('‚úÖ API com Luft Agro funcionando!')
        console.log(`üìä Total tickets: ${data2.total_tickets}`)
        console.log(`üìä Contextos selecionados: ${data2.selected_contexts}`)
        console.log(`üìä Tickets recentes: ${data2.recent_tickets?.length || 0}`)
        
        if (data2.recent_tickets && data2.recent_tickets.length > 0) {
          console.log('üìã Tickets do Luft Agro:')
          data2.recent_tickets.forEach(ticket => {
            console.log(`  - ${ticket.title}: ${ticket.status} (${ticket.priority})`)
          })
        }
      } else {
        console.log('‚ùå API com Luft Agro com erro:', response2.status, data2)
      }
    } catch (error) {
      console.log('‚ùå Erro ao testar API com Luft Agro:', error.message)
    }

    // 3. Testar API com m√∫ltiplos contextos
    console.log('\n3Ô∏è‚É£ TESTANDO API COM M√öLTIPLOS CONTEXTOS...')
    
    try {
      const luftAgroId = '6486088e-72ae-461b-8b03-32ca84918882'
      const testeId = 'a7791594-c44d-47aa-8ddd-97ecfb6cc8ed'
      const response3 = await fetch(`https://www.ithostbr.tech/api/dashboard/multi-client-stats-simple?context_ids=${luftAgroId},${testeId}`)
      const data3 = await response3.json()
      
      if (response3.ok) {
        console.log('‚úÖ API com m√∫ltiplos contextos funcionando!')
        console.log(`üìä Total tickets: ${data3.total_tickets}`)
        console.log(`üìä Contextos selecionados: ${data3.selected_contexts}`)
        console.log(`üìä Tickets recentes: ${data3.recent_tickets?.length || 0}`)
        
        if (data3.recent_tickets && data3.recent_tickets.length > 0) {
          console.log('üìã Tickets dos contextos selecionados:')
          data3.recent_tickets.forEach(ticket => {
            console.log(`  - ${ticket.title}: ${ticket.status} (${ticket.priority})`)
          })
        }
      } else {
        console.log('‚ùå API com m√∫ltiplos contextos com erro:', response3.status, data3)
      }
    } catch (error) {
      console.log('‚ùå Erro ao testar API com m√∫ltiplos contextos:', error.message)
    }

    // 4. Diagn√≥stico final
    console.log('\n4Ô∏è‚É£ DIAGN√ìSTICO FINAL...')
    
    console.log('üìä RESUMO DOS TESTES:')
    console.log('‚úÖ API simples criada')
    console.log('‚úÖ Testes realizados')
    
    console.log('\nüîß PR√ìXIMOS PASSOS:')
    console.log('1. Se API simples funcionar, atualizar frontend')
    console.log('2. Se API simples n√£o funcionar, investigar mais')
    console.log('3. Testar no dashboard principal')

  } catch (error) {
    console.error('‚ùå Erro geral:', error)
  }
}

testSimpleAPI()
